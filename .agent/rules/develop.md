---
description: 開発サイクルの基本ルール（ブランチ管理、コミット、検証、マージ）
trigger: always_on
---

# 開発ルール

このドキュメントは、エージェントが開発作業を行う際の基本規約を定義します。

## 1. 修正の開始
1.  **Issue発行**: 修正を開始する前に、必ずGitHubでIssueを発行すること。
2.  **概要の記載**: Issueには作業内容の要約を記載すること。
3.  **ブランチ作成**: 最新の `origin/develop` からブランチを切り出すこと。
    - ブランチ名形式: `feature/issue-[Issue番号]`
    - **Exception (Hotfix)**: 緊急修正の場合は `origin/main` から `hotfix/issue-[Issue番号]` を作成する。
4.  **CLIコマンドの安全性**: `gh` コマンド等で日本語や特殊文字（バッククォート、改行）を含む引数を渡す際は、シェルの解釈エラーを防ぐために適切なエスケープや引用符の使用を確認すること。
    - 推奨: 複雑なテキストはファイル経由で渡すか、シェル固有のエスケープルールに従う。

## 2. 開発とコーディング規約
1.  **コメント**: コード内のコメントは日本語で記述すること。
2.  **ログ**: 実装する際には適宜[ログ](file:///c:/Workspace/life_counter/lib/shared/utils/app_logger.dart)を埋め込むこと。
3.  **テストコードの維持**: 新しい機能を実装やリファクタリングをする際には、テストコードの作成及び既存テストコードのメンテナンスを行うこと。
4.  **フォーマット**: コミット前には必ず `dart format .` を実行し、コードを整形すること。

## 3. コミットルール
1.  **コミット単位**: 機能の追加や修正の論理的なまとまりなど、意味のある作業単位（atomic commit）名で適切にコミットを行うこと。
2.  **コミットメッセージ**: `type: #[Issue番号] 概要` の形式で記述すること。
    - 例: `feat: #111 自動テストの導入`
    - **コミットタイプ一覧**:
        - `feat`: 新機能
        - `fix`: バグ修正
        - `docs`: ドキュメントのみの変更
        - `style`: コードの動作に影響しない変更（空白、フォーマットなど）
        - `refactor`: バグ修正も機能追加も行わないコードの変更（リファクタリング）
        - `perf`: パフォーマンスを向上させる変更
        - `test`: テストの追加や既存テストの修正
        - `chore`: その他（ビルドプロセスやツールの変更など）

## 4. 品質保証 (必須)
コードを提出または編集する際は、以下のチェックを必ずローカルで実施し、パスすることを確認すること。
- `dart format .` (プロジェクト全体のフォーマット適用)
- `flutter analyze` (静的解析)
- `flutter test` (全ユニット/ウィジェットテストの実行)

## 5. 合流 (developへ)
1.  **PR作成**: 作業完了後、`origin/develop` へプルリクエストを作成すること。
2.  **マージ (CI待機)**: `gh pr merge --auto --merge` を実行し、CIチェック（GitHub Actions等）がパスした後に自動的にマージされるようにすること。
    - **Note**: `--admin` などによる強制マージは原則禁止とする。
3.  **ブランチの維持**: マージ後も元のブランチを削除しないこと（履歴保持のため）。
4.  **Issue管理**: `develop` へのマージ完了後、対応するIssueをクローズすること。

## 6. 同期
1.  マージ後は最新の `origin/develop` を `fetch` し、ローカルブランチに `pull` して最新状態を保つこと。
2.  **mainとの同期 (Backport)**: `main` ブランチが更新（リリース/Hotfix）された後は、`origin/main` を fetch し、ローカルの `develop` へマージして `origin/develop` へプッシュすること（PR不要）。
    - Note: コンフリクトが発生した場合は、ローカルで解消してからプッシュすること。

## 7. リリース
1.  `main` ブランチへのリリースを行う際は、[リリース手順](file:///c:/Workspace/life_counter/.agent/rules/release.md) に記載された手順に従うこと。
